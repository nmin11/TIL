**※ Pipeline**

1. Github 등의 저장소에 저장해 둔 애플리케이션 소스 코드를 내려받아 도커 컨테이너 이미지로 빌드
2. 빌드한 컨테이너 이미지를 쿠버네티스에서 사용할 수 있도록 레지스트리에 등록
3. 레지스트리에 등록된 이미지를 기반으로 쿠버네티스 오브젝트 생성
4. 생성한 오브젝트(Pod/Deployment)를 외부에서 접속할 수 있도록 서비스 형태로 노출

- 기존에는 이러한 파이프라인을 수작업으로 진행했지만 이제는 도구를 사용해서 자동화할 수 있음
- 자동화는 크게 CI(Continuous Integration), CD(Continuous Deployment) 2가지로 정의되며<br>일반적으로 둘을 합쳐서 CI/CD라고 함

<br>
<br>

# 컨테이너 인프라 환경에서 CI/CD

- CI : 코드를 커밋하고 빌드했을 때 정상적으로 작동하는지 반복적으로 검증해서<br>애플리케이션의 신뢰성을 높이는 작업
- CD : CI 과정에서 생성된 신뢰할 수 있는 애플리케이션을 실제 상용 환경에 자동으로 배포하는 것
- 애플리케이션 배포 시 고려 사항들을 CD에 미리 정의하면 실수를 줄이고 적용 시간도 최소화할 수 있음

※ 컨테이너 인프라 관점에서의 CI/CD

1. 개발자가 소스를 커밋하고 푸시하면 CI 단계 진입
2. 애플리케이션 자동 빌드 및 테스트를 통해 배포할 수 있는 애플리케이션인지 확인하고,<br>통과하면 CD 단계 진입
3. 애플리케이션을 컨테이너 이미지로 만들어서 Pod, Deployment, StatefulSet 등<br>다양한 오브젝트 조건에 맞춰 미리 설정한 파일을 통해 배포

<br>
<br>

## CI/CD 도구 비교

- Teamcity
  - Jetbrains에서 만들었으며, Kotlin을 기반으로 만든 Kotlin DSL이라는 스크립트 언어로 작업 구성
  - 빌드 작업을 수행하는 에이전트 3개와 빌드 작업 100개를 무료로 사용 가능
  - 더 많은 에이전트를 사용하려면 유료 결제를 해야 함
- Github Action
  - Github에서 지원하는 Workflow 기반의 CI/CD 도구
  - Github에 저장한 소스 코드를 자동 분석한 결과를 기반으로<br>Github Action이 추천하는 방식에 따라 Workflow를 구성하거나<br>사용자가 직접 Workflow를 정의하는 파일을 작성한 후 Github 저장소에 넣어 사용할 수 있음
  - Github 저장소가 public하면 무료로 사용 가능하지만 한 달에 2,000분이라는 제한 시간이 있음
  - 추가로 사용할 경우 분 단위의 요금이 별도로 부과됨
- Bamboo
  - Atlassian에서 만든 도구
  - 유료이며 사용자의 서버에 설치해서 사용함
  - Atalssian에서 만든 다른 협업 도구와 연계해서 사용하기에 좋음
- Jenkins
  - 오픈 소스 CI/CD 도구
  - 사용자가 직접 UI에서 작업을 구성하거나 작업 순서를 코드로 정의할 수 있음
  - 역사, 인지도, 사용자 수에서 CI/CD 도구의 대명사라 해도 될 정도로 널리 알려져 있음
  - 그만큼 필요한 정보를 찾기 쉽고 플러그인 개발 관련 커뮤니티 활동도 활발하여,<br>다양한 사용 환경, 언어 및 빌드 도구와 연계할 플러그인을 쉽게 찾을 수 있음
  - 특정 언어나 환경에 구애받지 않고 범용적인 목적으로 무난하게 쓸 수 있음

|   구분    | Teamcity  | Github Action |  Bamboo   |   Jenkins   |
| :-------: | :-------: | :-----------: | :-------: | :---------: |
| 설치 방식 | 직접 설치 |  Github 연동  | 직접 설치 |  직접 설치  |
| 연계 기능 |   보통    |     보통      |   부족    |  매우 많음  |
|   가격    | 무료/유료 |   무료/유료   |   유료    |    무료     |
| 기능 추가 |   보통    |  매우 다양함  |   보통    | 매우 다양함 |
|  범용성   |   보통    |    매우 큼    |   보통    |   매우 큼   |
|  정보량   |  부족함   |     많음      |   많음    |  매우 많음  |

<br>

- 이외에도 퍼블릭 클라우드 기반의 시스템일 때는<br>클라우드 서비스 제공 업체에서 배포하는 CI/CD 도구를 사용해볼 수도 있음
  - AWS CodeBuild, CodePipeline, CodeDeploy, GCP CloudBuild, Azure Pipelines
- 배포가 중요한 환경에서는 CD 기능에 중점을 둔 Spinnaker나 Argo CD를 선택적으로 도입할 수도 있음

<br>

**About Jenkins**

- 거의 모든 환경에서 사용할 수 있도록 다양한 플러그인을 추가해 원하는 형태를 만드는 블록 방식
- CI/CD를 처음 해볼 때는 가장 대중적인 젠킨스로 하는 것이 좋음

<br>
<br>

## 젠킨스로 쿠버네티스 운영 환경 개선하기

- 애플리케이션 배포 영역에 쿠버네티스를 사용하면 개발자는 애플리케이션 개발에만 집중할 수 있게 됨
- 모든 배포 환경을 컨테이너 인프라로 일원화하고, CI/CD 도구를 사용하면<br>애플리케이션에 맞는 환경을 적용해 자동으로 배포할 수 있음

※ 대략적인 과정

1. 개발자가 소스 코드를 저장소에 push
2. 쿠버네티스 내부에 설치된 젠킨스는 코드를 빌드하고 레지스트리에 push
3. 쿠버네티스에서 사용 가능한 형태로 배포

<br>

- 젠킨스는 작업 내용을 Item 단위로 정의하고 조건에 따라<br>자동으로 작업을 수행해서 효율을 높이고 실수를 줄임
- 컨테이너 인프라 환경에서 젠킨스를 사용하는 주된 이유는<br>애플리케이션을 컨테이너로 만들고 배포하는 과정을 자동화하기 위해서
- 그러기 위해 단순히 젠킨스용 파드만을 배포해서는 만들어지지 않음
- 젠킨스는 컨트롤러와 에이전트 형태로 구성한 다음 배포애야 하며 여기에 필요한 설정을 모두 넣어야 함
- 이러한 환경을 하나하나 구성하는 것은 복잡하고 번거롭기 때문에 동적으로 변경할 수 있게 해주는<br>kustomize나 Helm의 도움을 받으면 좋음
