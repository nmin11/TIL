## on call skills

### priority

[구글 클라우드의 지원 우선순위](https://cloud.google.com/support/docs/best-practice#setting_the_priority_and_escalating)

- P1: 프로덕션 환경의 서비스 불가능
- P2: 서비스 사용성의 심각한 저하
- P3: 서비스 사용성의 부분적 저하
- P4: 서비스 사용성에 문제 없음

SLI(Service Level Indicator)

- 애플리케이션의 정상가동 여부를 판단하는 가장 쉬운 방법
- 에러율, 요청 latency, 초당 요청 수 등의 지표 확인

SLO(Service Level Objective)

- 애플리케이션의 정상 동작 여부를 결정하기 위한 SLI 목표 정의

SLA(Service Level Agreement)

- SLO를 달성하지 못했을 때 어떻게 될 것인지에 대해 동의한 내용
- SLA 위반 시 비용 환불 및 계약이 해지될 수 있음

⇒ SLI는 서비스의 중요한 지표를, SLO, SLA는 장애의 우선순위 결정을

## 5 steps of failover

### 1. triage

- 문제의 영향도를 파악해서 우선순위 결정
  - SLI, SLO, SLA를 기반으로 결정
- 빠르게 실행되어야 하는 단계
- 벌써부터 트러블슈팅에 매달리지 말 것

### 2. coordination

- 담당자 선정
  - 우선순위가 낮다면 온콜 엔지니어가 담당
  - 우선순위가 높다면 장애 총책임자(incident commander)가 담당
- 관련된 모든 인원에게 장애에 대한 통지
- 대규모 장애라면 의사소통을 위해 상황실(war room)을 만듦
  - 상황실: 장애 대응 조율을 위한 가상 또는 물리적 공간
- 의사소통을 한곳에 기록해서 추적할 것

### mitigation

- 완화 단계의 목표 = 문제의 영향도 낮추기
- 문제를 해결하는 것이 아닌, 심각도를 낮춰 놓는 단계
- 문제 해결에는 많은 시간이 걸리지만 완화 작업은 대부분 신속하게 처리할 수 있으므로
- 통상적인 방법
  - 가장 최근의 정상적인 버전으로 롤백
  - 문제가 없는 쪽으로 트래픽 우회
- 문제 해결을 위한 runbook을 보고 지침에 따르자
- 문제를 완화하면서 수집할 수 있는 데이터는 최대한 모으자
  - 완화 작업 후 문제 재현이 어려워지므로

### resolution

- 기술적 문제 수습에 집중
- 가설-귀납에 따라 적절한 가설들을 검증해보며 문제를 살펴볼 것
- 오작동하는 프로그램 인스턴스를 격리해서 집중적으로 살펴볼 것
- 원인을 찾아 문제를 분석해야 함
  - 분석은 탐색이므로 탐색 알고리듬을 활용하자 (선형 탐색, 분할 정복, 이진 탐색)
- 가설 테스트
  - 문제를 재현하고, 오동작을 제어할 수 있는지 확인
  - 원인을 찾지 못했다면 잠재적 원인을 하나 제거한 셈 치고 다시 처음으로 돌아갈 것
- 테스트 성공 → 적합한 조치 → 검증

### follow-up

- 장애로부터 배울 것은 배우고 재발하지 않게 해야 함

postmortem

- 온콜 엔지니어가 작성
- 장애 원인, 알게 된 내용, 향후 재발 방지 방안 등 기록
- [Atlassian 템플릿](https://www.atlassian.com/incident-management/postmortem/templates)
- RCA(Root-Cause Analysis) 절이 가장 중요한 부분
  - "어째서" 발생했는지 5번 질문을 던지면서 원인에 대해 생각하는 과정

리뷰 회의

- 기술 리드 중 한 명이 관련자들과 리뷰 회의
- postmortem 작성자가 리뷰를 주도하고 참여자는 각 절의 내용을 상세히 논의
- 작성자는 논의 중 놓친 부분이나 새로운 업무를 추가
- 해결책은 회의가 아닌 후속 조치 업무를 통해 찾아야 함!

후속 조치

- 관리자나 postmortem 팀과 함께 업무 우선순위를 정하고 업무 진행

## don't be a hero

- '소방관' 역할을 잘하는 엔지니어는 팀에 선물 같은 존재가 되기도 함
- 하지만 온콜 업무가 과중되면 스트레스가 쌓이고 번아웃이 올 수 있음
- 소방관은 프로그래밍 및 설계 업무에 어려움을 겪게 될 수 있음
- 소방관에 의존하는 팀 또한 전문성이나 트러블슈팅 능력을 키우기 힘듬
