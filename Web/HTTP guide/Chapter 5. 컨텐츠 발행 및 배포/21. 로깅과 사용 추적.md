- 거의 모든 서버 및 프록시는 처리한 HTTP 트랜잭션을 요약해서 기록함
- 사용 추적, 보안, 청구, 에러 탐지 등을 위해서
- 이 장에서 배울 것들
  - 로깅
  - 어떤 HTTP 트랜잭션 정보를 기록하는지
  - 로그 포맷들

<br>

## 1. 로그란 무엇인가?

- 일반적으로 로깅을 하는 2가지 이유
  - 서버나 프록시의 문제 찾기
  - 웹 사이트 접근 통계
- 통계는 마케팅, 청구, 장비 조달 계획을 세우는 데 유용
- HTTP 트랜잭션의 모든 헤더를 로깅할 수도 있지만 감당해야 하는 트랜잭션이 장난이 아닐 수도 있음
- 일반적으로 로깅하는 필드들
  - HTTP 메소드
  - 요청받은 리소스의 URL
  - 클라이언트와 서버의 HTTP 버전
  - 응답의 HTTP 상태 코드
  - 요청과 응답 메시지의 크기
  - 트랜잭션이 일어난 시간
  - Referer와 User-Agent 헤더 값
- HTTP 메소드와 URL은 어떤 요청이 어떤 일을 하려고 했는지 가리킴
- 버전 정보는 문제가 생겼을 때 클라이언트와 서버에 관한 정보를 토대로 디버깅할 수 있게 함
- 요청/응답의 크기와 타임스탬프는 주로 계측을 위해 사용됨
  - 얼마나 많은 byte를 애플리케이션 안팎으로 송수신하는지

<br>

## 2. 로그 포맷

- 이 장에서는 가장 일반적인 몇 가지 포맷만 다룰 것
- 상용 및 오픈 소스 HTTP 애플리케이션은 대부분 표준 로그 포맷을 1개 이상 지원
- 애플리케이션 대부분이 로그 포맷을 설정할 수 있는 기능 제공

### 2.1 Common Log Format

- NCSA가 정의했으며, 대부분의 서버가 이 로그 포맷을 기본으로 사용
- 일반 로그 포맷 파일을 구문 분석하는 수많은 상용 혹은 무료 소프트웨어 도구들이 있음

※ Common Log Format의 필드들

|     필드      | 설명                                               |
| :-----------: | :------------------------------------------------- |
|  remotehost   | 요청한 컴퓨터의 호스트 명 혹은 IP 주소             |
|   username    | ident 검색을 수행했다면, 인증된 요청자 이름이 있음 |
| auth-username | 인증을 수행했다면, 인증된 요청자 이름이 있음       |
|   timestamp   | 요청 날짜와 시간                                   |
| request-line  | HTTP 요청 행을 그대로 기술                         |
| response-code | 응답으로 보내는 HTTP 상태 코드                     |
| response-size | 응답 엔티티의 Content-Length                       |

※ Common Log Format 엔트리의 몇 가지 예

```
209.1.32.44 - - [03/Oct/1999:14:16:00 -0400] "GET / HTTP/1.0" 200 1024
http-guide.com - dg [03/Oct/1999:14:16:32 -0400] "GET / HTTP/1.0" 200 477
http-guide.com - dg [03/Oct/1999:14:16:32 -0400] "GET /foo HTTP/1.0" 404 0
```

### 2.2 Combined Log Format

- 아파치 같은 서버들이 지원하는, 역시 많이들 사용하는 로그 포맷
- Common Log Format과 매우 유사
  - 사실, 추가된 필드 2개를 제외하면 똑같음

|    필드    | 설명                            |
| :--------: | :------------------------------ |
|  Referer   | Referer HTTP 헤더 값            |
| User-Agent | User-Agent Referer HTTP 헤더 값 |

```
209.1.32.44 - - [03/Oct/1999:14:16:00 -0400] "GET / HTTP/1.0" 200 1024 "http://www.joes-hardware.com/" "5.0: Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)"
```
