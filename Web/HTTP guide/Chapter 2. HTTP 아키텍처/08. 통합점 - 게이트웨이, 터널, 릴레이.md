- 시간이 지나면서 사람들은 더욱 복잡한 리소스(DB 컨텐츠나 동적 HTML 페이지)를 공유하기를 원했음
- HTTP 위에 다른 프로토콜을 얹으려 해도 우선 HTTP가 기본 구성 요소
  - HTTP는 웹에 있는 모든 리소스에 대한 프로토콜로 사용됨
  - 애플리케이션 간에 서로 다른 프로토콜을 상호 운용하는 용도로도 사용됨

※ 이번 장에서 살펴볼 내용들

- 게이트웨이: 서로 다른 프로토콜과 애플리케이션 간의 HTTP 인터페이스
- 애플리케이션 인터페이스: 서로 다른 웹 애플리케이션이 통신하는 데 사용됨
- 터널: HTTP 커넥션을 통해서 HTTP가 아닌 다른 트래픽을 전송하는 데 사용됨
- 릴레이: 일종의 단순한 HTTP 프록시로, 한 번에 한 개의 홉에 데이터를 전달하는 데 사용됨

<br>

## 1. 게이트웨이

- 웹에 복잡한 리소스를 올려야 할 필요가 생겼음
  - 모든 리소스를 한 개의 애플리케이션으로 처리할 수 없다는 것이 분명해졌음
  - HTTP의 확장과 인터페이스가 사람들의 필요에 따라 발전
- 개발자들은 이 문제에 대한 해결책으로 **인터프리터** 같이 리소스를 받기 위한 경로 안내 역할을 하는 게이트웨이를 고안해냈음
- 게이트웨이: 리소스와 애플리케이션을 연결하는 역할 수행
  - 애플리케이션은 게이트웨이에게 요청할 수 있고, 게이트웨이는 이에 응답할 수 있음
  - 요청을 받고 응답을 보내는 포털 같이 동작
  - 동적 컨텐츠를 생성하거나 DB에 질의를 보낼 수 있음

<img width="637" alt="gateway magic" src="https://user-images.githubusercontent.com/75058239/201547188-51302fe8-a046-46bc-9d1e-3f929a8c0c4a.png">

- 게이트웨이는 HTTP 트래픽을 다른 프로토콜로 자동 변환함
  - HTTP 클라이언트가 다른 프로토콜을 알 필요 없이 서버에 접속하게 해줄 수 있음

<img width="565" alt="웹 게이트웨이 예시" src="https://user-images.githubusercontent.com/75058239/201547201-9d0317ba-7110-41dc-a822-8ae06ea9f77e.png">

- 게이트웨이는 FTP URL을 가리키는 HTTP 요청을 수행할 수 있음
  - 게이트웨이는 FTP 서버에 적절한 명령을 전송
  - 클라이언트는 적절한 HTTP 헤더와 함께 HTTP를 통해서 문서를 받을 수 있음
- 게이트웨이는 암호화된 웹 요청을 SSL을 통해 받고 해독해서 생성한 일반 HTTP 요청을 목적지 서버에 전달할 수 있음
  - 이 경우 게이트웨이에 해당 서버에 대한 인증서가 설치되어 있어야 함
  - 이러한 보안 가속기는 원 서버에 고성능 암호화 기능을 제공하기 위해 웹 서버 바로 앞단에 위치시킴
- 게이트웨이는 애플리케이션 서버 게이트웨이 API를 통해서 클라이언트를 서버 측 애플리케이션 프로그램과 연결할 수 있음
  - 물건을 구입하거나, 일기예보를 보거나, 주식시세를 볼 때, 사실은 애플리케이션 서버 게이트웨이를 방문하는 것

### 1.1 클라이언트 측 게이트웨이와 서버 측 게이트웨이

- 게이트웨이의 양쪽 끝은 서로 다른 프로토콜로 통신함
- 게이트웨이는 클라이언트 측 프로토콜과 서버 측 프로토콜을 `/`으로 구분해서 기술함

```
<클라이언트 프로토콜>/<서버 프로토콜>
```

- 만약 게이트웨이가 HTTP 클라이언트와 NNTP 뉴스 서버 사이에 있다면 `HTTP/NNTP` 게이트웨이가 되는 것
- 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고, 서버와 외래 프로토콜로 통신함
- 클라이언트 측 게이트웨이는 클라이언트와 외래 프로토콜로 통신하고, 서버와는 HTTP로 통신함

<br>

## 2. 프로토콜 게이트웨이

- 프록시에 트래픽을 바로 보내듯 게이트웨이에도 트래픽을 바로 보낼 수 있음
- 보통 브라우저에 명시적으로 게이트웨이를 설정하거나, 대리 서버(리버스 프록시)로 설정함
- FTP와 같은 특정 프로토콜에 대해 HTTP/FTP 게이트웨이를 설정해서,<br>브라우저가 HTTP 명령을 보내면 게이트웨이는 FTP 요청으로 변환하여 처리하고, 결과를 HTTP로 전송함

![프로토콜 게이트웨이](https://user-images.githubusercontent.com/75058239/201776279-02e6e24e-8aee-43a0-bfb5-f3581b6fbd00.png)

### 2.1 HTTP/\* : 서버 측 웹 게이트웨이

<img width="498" alt="서버 측 웹 게이트웨이" src="https://user-images.githubusercontent.com/75058239/201776326-da1e48dc-382e-4c69-8374-528606192e31.png">

- HTTP 요청이 원 서버로 들어오는 시점에 HTTP 요청을 외래 프로토콜로 전환함
- 수행하는 작업
  - USER와 PASS 명령을 보내서 서버에 로그인
  - 서버상 적절한 디렉토리를 찾기 위해 CWS 명령을 내림
  - 다운로드 형식을 ASCII로 설정
  - MDTM으로 문서의 최근 수정 시간을 가져옴
  - PASV로 서버에게 수동형 데이터 검색을 하겠다고 전달
  - RETR(RETRIEVE) 명령으로 객체 검색
  - 제어 채널에서 반환된 포트로 커넥션을 맺고, 객체를 게이트웨이로 받아옴

### 2.2 HTTP/HTTPS : 서버 측 보안 게이트웨이

<img width="500" alt="보안 게이트웨이" src="https://user-images.githubusercontent.com/75058239/201776362-25777403-4c5b-42f8-8403-58a9d4f3e97b.png">

- 기업 내부의 모든 웹 요청을 암호화해서 개인 정보 보호와 보안을 제공하는 데에 게이트웨이를 사용할 수 있음
- 클라이언트는 HTTP를 사용할 수 있지만 게이트웨이는 자동으로 사용자의 모든 세션을 암호화할 것

### 2.3 HTTPS/HTTP : 클라이언트 측 보안 가속 게이트웨이

<img width="498" alt="보안 가속 게이트웨이" src="https://user-images.githubusercontent.com/75058239/201776384-d89a6716-3a89-46c9-9d1c-fe604350419a.png">

- 웹 서버 앞단에서 보이지 않는 인터셉트 게이트웨이나 리버스 프록시 역할 수행
- 보안 HTTPS 트래픽을 받아서 복호화하고 웹 서버로 보낼 일반 HTTP 요청을 만듦
- 원 서버보다 더 효율적으로 보안 트래픽을 복호화하는 암호화 하드웨어를 내장해서 원 서버의 부하를 줄여주기도 함
- 게이트웨이와 서버 사이에는 확실한 네트워크 안전 보장이 필요함

<br>

## 3. 리소스 게이트웨이

- 여기까지 클라이언트와 서버를 연결하는 게이트웨이에 대해 이야기했음
- 그러나 게이트웨이의 가장 일반적인 형태인 애플리케이션 서버는 목적지 서버와 게이트웨이를 하나의 서버로 결합함
  - 애플리케이션 서버는 HTTP를 통해서 클라이언트와 통신하고 서버 측 애플리케이션 프로그램에 연결하는 서버 측 게이트웨이

![리소스 게이트웨이](https://user-images.githubusercontent.com/75058239/202045705-6ad30f74-7cbb-4dda-9855-d7013fa7f50e.png)

- 애플리케이션 서버는 게이트웨이의 API(Application Programming Interface)를 통해<br>요청을 서버에서 동작하고 있는 애플리케이션에 전달
- CGI(Common Gateway Interface) : 애플리케이션 게이트웨이에서 유명했던 최초의 API
  - 특정 URL에 대한 HTTP 요청에 따라 프로그램 실행, 출력 수집, HTTP 응답으로 회신하는,<br>웹 서버가 사용하는 표준화된 인터페이스 집합
- 웹 서버는 지금까지도 게이트웨이의 인터페이스를 구현하는 단순한 접근 방식을 이어오고 있음
- 게이트웨이를 통해야만 받을 수 있는 요청이 들어온 경우, 서버는 헬퍼 애플리케이션을 생성해서 요청을 처리함

### 3.1 CGI

- CGI는 최초이면서 지금까지도 가장 널리 쓰이는 서버 확장
- 웹에서 동적 HTML, 신용카드 결제, DB 질의 등을 제공하는 데에 사용됨
- CGI 애플리케이션은 서버와 분리되면서 수많은 언어로 구현할 수 있게 되었음
- 또한 CGI는 단순하므로 거의 모든 HTTP 서버가 지원함
- CGI의 내부 처리 과정은 사용자에게 보이지 않음
  - CGI가 무언가를 하고 있다는 것을 알 수 있는 유일한 단서는 URL에 있는 `cgi` 혹은 `?` 키워드
- CGI는 거의 모든 리소스 형식과 서버의 접점에 있으면서, 필요에 따라 어떤 변형이든 처리해내는 단순한 기능을 제공함
  - 확장으로부터 서버를 보호한다는 점에서는 훌륭함
- 하지만 이러한 분리 때문에 성능 관련 비용이 발생함
  - 모든 CGI 요청마다 새로운 프로세스를 만들면서 따르는 부하가 꽤 큼
- 문제점을 개선하고자 새로운 CGI 형식인 Fast CGI가 개발되었음
  - CGI와 유사하지만 데몬으로 동작함으로써 요청마다 새로운 프로세스를 만들고 제거함

### 3.2 서버 확장 API

- 모듈을 HTTP와 직접 연결할 수 있는 강력한 인터페이스, 서버 확장 API가 필요한 2가지 이유
  - 서버 자체의 동작을 바꾸고 싶음
  - 서버의 처리능력을 최고치로 올리고자 함
- 유명 서버 대부분은 확장 API를 1개 이상 제공해줌
  - 이러한 확장은 서버 자체의 아키텍처에 의존함
- 예시: MS - FrontPage Server Extension(FPSE)
  - RPC 명령을 HTTP POST 메소드를 통해서 인식할 수 있음

<br>

## 4. 애플리케이션 인터페이스와 웹 서비스

- 애플리케이션 연결 시 까다로운 점은 두 애플리케이션 사이에 프로토콜 인터페이스를 맞추는 일
- 상호 운용 시 HTTP 헤더로는 표현하기 힘든 복잡한 정보를 교환해야 할 수도 있음
  - 나중 내용에서 HTTP 확장 및 HTTP 위에 프로토콜을 덧씌우는 방식에 대해 알아볼 것
- 인터넷 커뮤니티는 웹 애플리케이션이 통신하는데 사용할 표준 및 프로토콜 집합을 개발했음
- 이 표준은 그냥 웹 서비스라고 불리게 되었음
  - 사실은 독립형 웹 애플리케이션 그 자체를 의미함
- 웹 서비스는 애플리케이션이 정보를 공유하는 새로운 메커니즘으로, HTTP 같은 표준 웹 기술 위에서 개발됨
  - 웹 서비스는 SOAP를 통해 XML을 사용하여 정보를 교환함
  - XML(eXtensible Markup Language)은 데이터 객체를 담는 데이터를 생성하고 해석하는 방식을 제공함
  - SOAP(Simple Object Access Protocol)은 HTTP 메시지에 XML 데이터를 담는 방식에 대한 표준
  - 현대 웹 서비스의 데이터 교환 방식은 SOAP보다 REST 방식을 더 많이 사용하며, 데이터 포맷도 XML보다는 JSON을 주로 사용함
