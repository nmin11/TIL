- 시간이 지나면서 사람들은 더욱 복잡한 리소스(DB 컨텐츠나 동적 HTML 페이지)를 공유하기를 원했음
- HTTP 위에 다른 프로토콜을 얹으려 해도 우선 HTTP가 기본 구성 요소
  - HTTP는 웹에 있는 모든 리소스에 대한 프로토콜로 사용됨
  - 애플리케이션 간에 서로 다른 프로토콜을 상호 운용하는 용도로도 사용됨

※ 이번 장에서 살펴볼 내용들

- 게이트웨이: 서로 다른 프로토콜과 애플리케이션 간의 HTTP 인터페이스
- 애플리케이션 인터페이스: 서로 다른 웹 애플리케이션이 통신하는 데 사용됨
- 터널: HTTP 커넥션을 통해서 HTTP가 아닌 다른 트래픽을 전송하는 데 사용됨
- 릴레이: 일종의 단순한 HTTP 프록시로, 한 번에 한 개의 홉에 데이터를 전달하는 데 사용됨

<br>

## 1. 게이트웨이

- 웹에 복잡한 리소스를 올려야 할 필요가 생겼음
  - 모든 리소스를 한 개의 애플리케이션으로 처리할 수 없다는 것이 분명해졌음
  - HTTP의 확장과 인터페이스가 사람들의 필요에 따라 발전
- 개발자들은 이 문제에 대한 해결책으로 **인터프리터** 같이 리소스를 받기 위한 경로 안내 역할을 하는 게이트웨이를 고안해냈음
- 게이트웨이: 리소스와 애플리케이션을 연결하는 역할 수행
  - 애플리케이션은 게이트웨이에게 요청할 수 있고, 게이트웨이는 이에 응답할 수 있음
  - 요청을 받고 응답을 보내는 포털 같이 동작
  - 동적 컨텐츠를 생성하거나 DB에 질의를 보낼 수 있음

<img width="637" alt="gateway magic" src="https://user-images.githubusercontent.com/75058239/201547188-51302fe8-a046-46bc-9d1e-3f929a8c0c4a.png">

- 게이트웨이는 HTTP 트래픽을 다른 프로토콜로 자동 변환함
  - HTTP 클라이언트가 다른 프로토콜을 알 필요 없이 서버에 접속하게 해줄 수 있음

<img width="565" alt="웹 게이트웨이 예시" src="https://user-images.githubusercontent.com/75058239/201547201-9d0317ba-7110-41dc-a822-8ae06ea9f77e.png">

- 게이트웨이는 FTP URL을 가리키는 HTTP 요청을 수행할 수 있음
  - 게이트웨이는 FTP 서버에 적절한 명령을 전송
  - 클라이언트는 적절한 HTTP 헤더와 함께 HTTP를 통해서 문서를 받을 수 있음
- 게이트웨이는 암호화된 웹 요청을 SSL을 통해 받고 해독해서 생성한 일반 HTTP 요청을 목적지 서버에 전달할 수 있음
  - 이 경우 게이트웨이에 해당 서버에 대한 인증서가 설치되어 있어야 함
  - 이러한 보안 가속기는 원 서버에 고성능 암호화 기능을 제공하기 위해 웹 서버 바로 앞단에 위치시킴
- 게이트웨이는 애플리케이션 서버 게이트웨이 API를 통해서 클라이언트를 서버 측 애플리케이션 프로그램과 연결할 수 있음
  - 물건을 구입하거나, 일기예보를 보거나, 주식시세를 볼 때, 사실은 애플리케이션 서버 게이트웨이를 방문하는 것

### 1.1 클라이언트 측 게이트웨이와 서버 측 게이트웨이

- 게이트웨이의 양쪽 끝은 서로 다른 프로토콜로 통신함
- 게이트웨이는 클라이언트 측 프로토콜과 서버 측 프로토콜을 `/`으로 구분해서 기술함

```
<클라이언트 프로토콜>/<서버 프로토콜>
```

- 만약 게이트웨이가 HTTP 클라이언트와 NNTP 뉴스 서버 사이에 있다면 `HTTP/NNTP` 게이트웨이가 되는 것
- 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고, 서버와 외래 프로토콜로 통신함
- 클라이언트 측 게이트웨이는 클라이언트와 외래 프로토콜로 통신하고, 서버와는 HTTP로 통신함

<br>

## 2. 프로토콜 게이트웨이

- 프록시에 트래픽을 바로 보내듯 게이트웨이에도 트래픽을 바로 보낼 수 있음
- 보통 브라우저에 명시적으로 게이트웨이를 설정하거나, 대리 서버(리버스 프록시)로 설정함
- FTP와 같은 특정 프로토콜에 대해 HTTP/FTP 게이트웨이를 설정해서,<br>브라우저가 HTTP 명령을 보내면 게이트웨이는 FTP 요청으로 변환하여 처리하고, 결과를 HTTP로 전송함

![프로토콜 게이트웨이](https://user-images.githubusercontent.com/75058239/201776279-02e6e24e-8aee-43a0-bfb5-f3581b6fbd00.png)

### 2.1 HTTP/\* : 서버 측 웹 게이트웨이

<img width="498" alt="서버 측 웹 게이트웨이" src="https://user-images.githubusercontent.com/75058239/201776326-da1e48dc-382e-4c69-8374-528606192e31.png">

- HTTP 요청이 원 서버로 들어오는 시점에 HTTP 요청을 외래 프로토콜로 전환함
- 수행하는 작업
  - USER와 PASS 명령을 보내서 서버에 로그인
  - 서버상 적절한 디렉토리를 찾기 위해 CWS 명령을 내림
  - 다운로드 형식을 ASCII로 설정
  - MDTM으로 문서의 최근 수정 시간을 가져옴
  - PASV로 서버에게 수동형 데이터 검색을 하겠다고 전달
  - RETR(RETRIEVE) 명령으로 객체 검색
  - 제어 채널에서 반환된 포트로 커넥션을 맺고, 객체를 게이트웨이로 받아옴

### 2.2 HTTP/HTTPS : 서버 측 보안 게이트웨이

<img width="500" alt="보안 게이트웨이" src="https://user-images.githubusercontent.com/75058239/201776362-25777403-4c5b-42f8-8403-58a9d4f3e97b.png">

- 기업 내부의 모든 웹 요청을 암호화해서 개인 정보 보호와 보안을 제공하는 데에 게이트웨이를 사용할 수 있음
- 클라이언트는 HTTP를 사용할 수 있지만 게이트웨이는 자동으로 사용자의 모든 세션을 암호화할 것

### 2.3 HTTPS/HTTP : 클라이언트 측 보안 가속 게이트웨이

<img width="498" alt="보안 가속 게이트웨이" src="https://user-images.githubusercontent.com/75058239/201776384-d89a6716-3a89-46c9-9d1c-fe604350419a.png">

- 웹 서버 앞단에서 보이지 않는 인터셉트 게이트웨이나 리버스 프록시 역할 수행
- 보안 HTTPS 트래픽을 받아서 복호화하고 웹 서버로 보낼 일반 HTTP 요청을 만듦
- 원 서버보다 더 효율적으로 보안 트래픽을 복호화하는 암호화 하드웨어를 내장해서 원 서버의 부하를 줄여주기도 함
- 게이트웨이와 서버 사이에는 확실한 네트워크 안전 보장이 필요함
