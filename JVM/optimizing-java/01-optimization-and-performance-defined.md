## 1. 자바 성능: 잘못된 방법

우수한 성능 목표를 달성하기 위해 필요한 여러 가지 단면들

- 전체 소프트웨어 수명주기의 성능 방법론
- 성능과 연관된 테스트 이론
- 측정, 통계, 툴링
- 시스템 + 데이터 분석 스킬
- 하부 기술과 메커니즘

※ 코드 수준의 테크닉은 책의 끝부분에 있음 → 모든 최적화 기법은 트레이드오프가 도사리고 있으니 주의할 것

## 2. 자바 성능 개요

> 자바는 블루 칼라 언어입니다.
> 박사 학위 논문 주제가 아니라 일을 하려고 만든 언어죠.
>
> ― 제임스 고슬링

개발자의 생산성, 실용성을 위해 어느 정도의 성능 희생은 감수하는 언어

- 그러나 최근 핫스팟 같은 정교한 JVM이 나오면서 고성능 컴퓨팅 애플리케이션에도 적합한 수준에 이르렀음
- **managed subsystem**
  - 개발자가 일일이 용량을 세세하게 관리하는 부담을 덜어주는 대신, 저수준에서의 일부 기능 제어를 포기
  - 대표적인 예시가 가비지 컬렉터
  - managed subsystem은 존재 자체로 JVM 애플리케이션의 런타임 동작에 복잡도를 유발함

JVM 애플리케이션의 성능 측정

- 정규 분포를 따르는 기초 통계 기법(표준편차, 분산 등)만 갖고는 제대로 된 측정 결과를 얻을 수 없음
- 측정하는 행위 자체도 오버헤드를 일으키며, 너무 자주 샘플링하거나 결과를 기록하는 행위도 성능 결과 수치에 적잖은 영향을 미침
- 그러므로 자바 성능 수치에는 섬세한 손질이 필요하다

## 3. 성능은 실험과학이다

JVM 성능 튜닝

- 기술, 방법론, 정량적 측정값, 툴을 망라한 개념
- 목표는 시스템 소유자 및 유저가 추구하는 측정 결과를 얻는 것

성능 분석

- 비기능 요건을 정의하고 달성하는 활동
- 통계치에 근거해 적절히 결과를 처리하는 활동
- 프로젝트 아티펙트와 제품 일부를 형성

## 4. 성능 분류

성능 지표

- 성능 분석의 어휘집이자, 목표를 정량적인 단위로 표현한 기준
- 성능 목표를 정의한 비기능 요건
- 모든 지표가 동시에 최적화되는 경우는 거의 없음
  - 성능 이터레이션을 수행할 때마다 2~3개 지표가 개선되는 정도
  - 실제로는 어느 한 지표를 최적화하면 다른 지표들이 약화되는 경우도 흔함
- 가장 일반적인 기본 성능 지표들에 대해 알아볼 것

### 4.1 처리율 (throughput)

- 시스템이 수행 가능한 작업 비율을 나타낸 지표
- 보통 일정 시간 동안 완료한 작업 단위 수로 표시
- 처리율이 실제 성능을 반영하는 의미 있는 지표가 되려면
  - 기준 플랫폼에 대한 내용을 기술해야 함(하드웨어, OS, 단일 서버인지 클러스터 환경인지 등)
  - 트랜잭션은 테스트할 때마다 동일해야 함
  - 실행 간 워크로드도 일정하게 유지해야 함

### 4.2 지연 (latency)

- 하나의 트랜잭션을 처리하고 그 결과를 관측할 때까지 소요된 시간
- 종단 시간이라고도 부름
- 대개 그래프에서 워크로드에 비례하는 함수로 표시

### 4.3 용량 (capacity)

- 시스템이 보유한 작업 병렬성의 총량
  - 쉽게 말해서 시스템이 동시에 처리 가능한 트랜잭션 개수
- 처리율과 밀접한 연관이 있음
  - 시스템에 동시 부하가 증가할수록 처리율도 영향을 받기 때문
  - 보통 특정 처리율 또는 지연 값을 전제로 가능한 처리량으로 표시

### 4.4 사용률 (utilization)

- CPU, 메모리 등의 시스템 리소스를 어떻게 사용하고 있는지 측정
- 워크로드의 특성에 따라서 리소스별로 들쑥날쑥할 수 있음

### 4.5 효율 (efficiency)

- 전체 시스템의 효율 = 처리율 / 사용률
- 같은 처리율을 더 적은 리소스로 달성할 수 있어야 효율이 높은 것

### 4.6 확장성 (scalability)

- 리소스 추가에 따른 처리율 변화는 시스템/애플리케이션의 확장성을 가늠하는 척도
- 리소스를 투입한 만큼 정확히 처리율이 변경되는 형태를 지향
- 선형 확장
  - 클러스터 기반 시스템의 클러스터를 2배 확장해서 트랜잭션 처리량도 2배 늘었다면 '완벽한 선형 확장'
  - 그러나 현실적으로 선형 확장 달성은 매우 어려움
  - 보통 시스템 확장성은 여러 가지 인자들의 영향을 받으므로
  - 어느 정도까지는 선형 확장이 되지만 부하가 높아지면 완벽한 확장을 저해하는 한계점에 봉착

### 4.7 저하 (degradation)

- 시스템이 더 많은 부하를 받으면 지연 및 처리율 측정값에 변화가 생김
- 변화는 사용률이 낮으면 느슨하게 변하지만, 사용률이 높으면 처리율이 늘어나지 않고 지연이 증가하는 양상을 보임
- 위와 같은 현상을 부하 증가에 따른 저하라고 함

### 4.8 측정값 사이의 연관 관계

- 다양한 성능 측정값은 어떤 식으로든 서로 연결돼 있음
- 구체적인 상호 관계는 시스템이 풀 가동 중인지 여부에 따라 달라짐
  - 이미 시스템에 상당한 부하가 걸려 있는 상태면 부하가 조금만 늘어도 다른 측정값이 크게 요동칠 수 있음
- 확장성과 저하
  - 부하가 증가함에 따라 시스템 양상이 더떻게 바뀌는지 반영하는 지표
  - 시스템이 확장한 리소스를 제대로 활용할 수 있을지가 관건
  - 만약 부하가 늘었는데 리소스는 그대로라면 저하되는 성능 측정값(지연)이 있을 것
- 시스템 일부가 리소스를 집중적으로 소모하는 고성능 모드로 전환되면 부하가 증가해도 오히려 지연이 감소하는 모습을 보일 수도 있음
