_NoSQL Serverless Database_

- fully managed
- highly available with replication across multiple AZs
- scales to massive workloads, distributed database
- millions of requests per seconds, trillions of row, 100s of TB storage
- fast and consistent in performance (low latency on retrieval)
- integrated with IAM for security, authorization and administration
- enables event driven programming with DynamoDB Streams
- low cost and auto-scaling capabilities
- Standard & Infrequent Access(IA) Table Class

<br>

## Basics

- **Tables**로 구성
- 각 table은 **Primary Key**를 가짐
- 각 table은 items(rows)를 무한대로 가질 수 있음
- 각 item은 **attributes**를 가짐
- maximum size of an item: **400KB**
- data types supported are :
  - **Scalar Types** : String, Number, Binary, Boolean, Null
  - **Document Types** : List, Map
  - **Set Types** : String Set, Number Set, Binary Set

<br>

## Primary Keys

**Option 1: Partition Key (HASH)**

- 일반적인 DB와 유사하게 각 item마다 고유해야 함
- 데이터가 분산될 수 있을 만큼 "diverse"해야 함

**Option 2: Partition Key + Sort Key (HASH + RANGE)**

- 두 항목의 조합이 각 item마다 고유해야 함
  - 같은 partition key를 가지는 item이 있을 수 있지만, 이 경우 sort key가 달라야 함
- data is grouped by partition key

<br>

## Read / Write Capacity Modes

- table의 용량을 제어 (read/write throughput)
- 24시간마다 모드 전환 가능

### Provisioned Mode

- reads/writes per second 특정
- 프로비저닝된 용량에 따라 비용 지불
- table은 반드시 read/write 용량을 프로비저닝해야 함
- **Read Capacity Units (RCU)** - throughput for reads
- **Write Capacity Units (WCU)** - throughput for writes
- 수요를 맞추기 위해서 처리량을 auto-scaling하는 옵션이 있음
- 처리량이 프로비저닝된 용량을 넘어설 경우 임시로 **Burst Capacity** 사용
- Burst Capacity를 다 소진하면 ProvisionedThroughputExceededException 발생
- 예외 발생 시 retry는 exponential backoff 사용 권장

### On-Demand Mode

- workloads에 기반해서 read/write을 자동으로 scaling
- 사전에 용량을 계획하지 않음
- 정확히 사용한 만큼 지불하지만 약 2.5배 더 비쌈
- 실제로 사용한 RRU 및 WRU에 따라 비용 청구
- **Read Request Units (RRU)** - throughput for reads
- **Write Request Units (WRU)** - throughput for writes

### Write Capacity Units (WCU)

- 1 WCU는 최대 1KB item에 대해 초당 1개의 쓰기를 의미
- item이 1KB보다 큰 경우 더 많은 WCU 사용

### Read Capacity Units (RCU)

- 1 RCU ==
  - 1 Stronly Consistent Read per second
  - 2 Eventually Consistent Reads per second
  - for an item up to 4 KB in size
- item이 4KB보다 큰 경우 더 많은 RCU 사용

#### Strongly Consistent Read vs Eventually Consistent Read

**Eventually Consistent Read (default)**

- 쓰기 직후에 읽기를 수행하면 복제가 되기 전에 조회되어 오래된 데이터를 얻게 될 수 있음
- 100ms 이후라면 괜찮

**Strongly Consistent Read**

- 쓰기 직후에 읽기를 수행해도 금방 쓰인 데이터를 읽을 수 있음
- 이를 활용하기 위해 API 호출시 **ConsistentRead** 파라미터를 true로 지정해야 함
  - GetItem, BatchGetItem, Query, Scan 등을 호출할 때
- RCU를 2번 소비하고 latency도 더 높음

<br>

## Partitions Internal

- 데이터는 table 안의 partition들에 저장됨
- Partition Keys는 hashing algorithm을 통과해서 가게 될 partition을 알게 됨
- WCU와 RCU에 따라 데이터는 각 partition에 고르게 분배됨

<br>

## Throttling

- RCU 혹은 WCU가 partition level에서 초과했을 때 **ProvisionedThroughputExceededException** 발생
- Reasons :
  - **Hot Keys** : 하나의 partition key가 너무 많이 읽혔을 때
  - **Hot Partitions**
  - **Very large items** : RCU와 WCU는 item의 size에 의존한다는 것을 명심할 것
- Solutions :
  - **Exponential backoff** : SDK에 이미 포함되어 있음
  - **Distribute partition keys**
  - **DynamoDB Accelerator (DAX)** : RCU 관련 이슈인 경우
