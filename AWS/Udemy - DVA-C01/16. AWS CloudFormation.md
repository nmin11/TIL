## Infrastructure as Code

- 수동 작업의 경우 재생산이 어려움
  - 다른 region으로의 복제
  - 다른 AWS account에서 복사
  - 같은 region에서라도 전부 삭제하고 재생성하는 경우
- 그래서 인프라가 될 수 있는 코드가 필요
- 코드가 인프라를 create / update / delete

<br>

## What is CloudFormation

- 모든 리소스에 대한 AWS 인프라 개요를 선언하는 방식
- 대부분의 서비스가 지원됨
- CloudFormation은 지정한 인프라 설정을 **right order**에 따라, **exact configuration**에 맞게 선언

<br>

## Benefits of AWS CloudFormation

- Infrastructure as code
  - 수동으로 생성되는 리소스 없어서 제어하기에 좋음
  - 모든 코드는 version control이 가능함 (Git 등을 활용할 수 있음)
  - 인프라의 모든 변경 사항은 코드 리뷰를 통해 검토
- Cost
  - CloudFormation 자체는 무료이지만 생성한 모든 stack에 식별자가 있어서 손쉽게 stack의 비용 추적 가능
  - CloudFormation template으로 리소스 비용을 측정할 수 있음
  - Saving strategy: dev 환경의 경우 저녁 시간에 template을 삭제하고 오전 시간에 재생성하면 좋음
- Productivity
  - 원하는 만큼 인프라를 삭제하고 재생성할 수 있음
  - 프레젠테이션을 생성하면 자동으로 도표가 생성되도록 할 수 있음
  - 선언형 프로그래밍 (순서 및 조정에 대해 파악할 필요가 없음)
- Separation of concern
  - 많은 app과 layer에 원하는 만큼의 stack을 가질 수 있음
  - VPC stacks, Network stacks, App stacks
- Don't re-invent the wheel
  - 수많은 template 존재
  - 공식 문서도 잘 정의되어 있음

<br>

## How CloudFormation Works

- S3에 template을 업로드하면 CloudFormation이 가져옴
- template을 업로드할 때 이전 template은 수정 불가
  - 새 버전의 template을 재업로드해야 함
- stack은 이름으로 식별됨
- stack을 삭제하면 CloudFormation에서 생성한 모든 단일 artifact를 삭제

<br>

## Deploying CloudFormation templates

- Manual way :
  - CloudFormation Designer에서 template 수정
  - 콘솔에서 매개변수를 입력하는 방법
- Automated way :
  - YAML 파일에서 template 수정
  - AWS CLI를 사용해서 template 배포
  - flow의 일부 자동화를 원할 때 추천하는 방식

<br>

## CloudFormation Building Blocks

Templates components

1. Resources: template에서 선언할 AWS 리소스 (MANDATORY)
2. Parameters: 사용자가 template에 요청할 수 있는 동적 입력값
3. Mappings: template의 정적 변수
4. Outputs: template에서 보낸 일부를 다른 template에서 참조하는 것
5. Conditionals: 조건들의 목록으로 if문으로 생성되는 것들 제어
6. Metadata

Templates helpers

1. References
2. Functions
