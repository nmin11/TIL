## Scalability & High Availability

- 확장성: 애플리케이션 시스템이 조정을 통해서 더 많은 양을 처리할 수 있다는 의미
  - 수직 확장성
  - 수평 확장성 (=탄력성)
- 확장성과 고가용성은 연관된 개념이지만 서로 다름

### Vertical Scalability

- 인스턴스의 크기 확장을 의미
- 예를 들어 t2.micro를 사용하다가 t2.large로 업그레이드한 경우
- 수직 확장은 데이터베이스와 같이 분산되지 않은 시스템에서 흔히 사용됨
  - RDS, ElasticCache
- 하드웨어의 제한에 따라 수직 확장할 수 있는 한계가 정해져 있음

### Horizontal Scalability

- 애플리케이션에서 인스턴스나 시스템의 수를 늘리는 방법
- 수평 확장을 했다는 것은 분배 시스템이 있다는 것을 의미
- 웹 애플리케이션이나 현대 애플리케이션은 대부분 분배 시스템으로 이루어져 있음
- EC2와 같은 서비스 덕분에 수평 확장이 더욱 수월해졌음
  - 새 EC2를 순식간에 만들 수 있기 때문

### High Availability

- 보통은 수평 확장과 함께 사용되는 개념이지만 항상 그런 것은 아님
- 애플리케이션 또는 시스템을 적어도 둘 이상의 AZ나 데이터 센터에서 가동 중이라는 뜻
- Goal: 데이터 센터의 손실에서 살아남는 것
- 수동적일 수 있음
  - RDS가 다중 AZ를 갖추고 있는 경우 수동형 고가용성을 확보한 것
- 활성형도 될 수 있음
  - 수평적 확장을 하는 경우

### Scalability & High Availability For EC2

- 수직 확장: 인스턴스 크기를 늘리는 것
- 수평 확장: 인스턴스의 수를 늘리는 것
  - Auto Scaling Group, Load Balancer
- 고가용성: 동일 애플리케이션의 동일 인스턴스를 다수의 AZ에 걸쳐 실행하는 것
  - Auto Scaling Group multi AZ, Load Balancer multi AZ

<br>

## Elastic Load Balancing 개요

### What is load balancing?

- 서버 또는 서버셋으로 트래픽을 백엔드나 다운스트림 EC2 인스턴스 또는 서버들로 전달하는 역할 수행
- 접속하는 유저들은 ELB로 바로 연결됨
- 유저들은 ELB에 의해 각자 다른 EC2 인스턴스에 요청을 전송하게 됨
- 이 과정을 통해 EC2 인스턴스로 가는 부하가 분산됨
- 유저들은 어떤 EC2에 연결되는지 알 수 없고, 다만 한 엔드포인트에 연결된다는 것만 알고 있음

### Why use a load balancer?

- 부하를 다수의 다운스트림 인스턴스로 분산하기 위해서
- 애플리케이션에서 단일 access 지점(DNS)을 노출하기 위해서
- 다운스트림 인스턴스의 장애를 원활히 처리하기 위해서
  - 로드 밸런서가 health check 메커니즘을 통해 어떤 인스턴스로 트래픽을 보낼 수 없는지 확인해줌
- SSL 종료를 할 수 있게 되므로 웹 사이트에 암호화된 HTTPS 트래픽을 가질 수 있게 됨
- 쿠키를 강화하기 위해서
- 고가용성을 갖추기 위해서
- 클라우드 내에서 개인 트래픽과 공공 트래픽을 분리하기 위해서
- ELB = managed load balancer
  - AWS가 관리하며, 어떤 경우에도 작동할 것을 보장
  - AWS가 업그레이드, 유지 관리, 고가용성을 책임지고 있음
  - 로드 밸런서의 작동 방식을 수정할 수 있게끔 일부 구성 knob들을 제공
- ELB는 무조건 쓰는 편이 좋음
  - 자체 로드 밸런서를 마련하는 것보다 저렴
  - 직접 관리하는 것보다 확장성에 용이
- 다수의 AWS 서비스들과 통합되어 있음
  - EC2, EC2 Auto Scaling Groups, Amazon ECS, ACM, CloudWatch, Rout 53, AWS WAF, AWS Global Accelerator 등

### Health Checks

- ELB가 EC2 인스턴스의 작동이 올바르게 되고 있는지 여부를 확인하기 위해 사용됨
- port와 route에서 이루어짐 (`/health` 엔드포인트가 자주 사용됨)
- EC2로부터 200 OK를 받지 못하면 인스턴스 상태가 좋지 못하다고 기록됨
  - ELB는 해당 인스턴스로 트래픽을 보내지 않게 됨

### Type of load balancer on AWS

AWS에는 4종류의 managed Load Balancer들이 있음

- Classic Load Balancer (v1 - 구세대) - 2009 - CLB
  - HTTP, HTTPS, TCP, SSL, secure TCP 지원
  - AWS에서 사용을 권장하지 않고 있음 → 콘솔에서도 더이상 사용할 수 없는 것으로 나오지만 아직 사용이 가능은 함
- Application Load Balancer (v2 - 신세대) - 2016 - ALB
  - HTTP, HTTPS, WebSocket 지원
- Network Load Balancer (v2 - 신세대) - 2017 - NLB
  - TCP, TLS, secure TCP, UDP 지원
- Gateway Load Balancer - 2020 - GWLB
  - 네트워크 계층의 3계층, IP Protocol

=> 더 많은 기능을 갖춘 신형 로드 밸런서 사용 권장

### Load Balancer Security Groups

- 유저는 HTTP/HTTPS를 사용해서 어디서든 로드 밸런서에 접근 가능
  - 따라서 보안 그룹도 이에 맞게 설정되어야 할 것
- 반면 EC2는 곧바로 들어오는 트래픽만 허용해야 하기 때문에 HTTP로만 받아야 하며,<br>Source IP도 로드 밸런서의 보안 그룹이 되어야 할 것
  - EC2는 오직 로드 밸런서에서 오는 트래픽만을 허용해야 함
