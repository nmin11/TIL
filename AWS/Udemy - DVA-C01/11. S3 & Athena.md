## S3 MFA Delete

- S3에서 중요한 작업을 하기 전에 MFA 인증을 받게 할 수 있음
- 이 기능 사용을 위해 S3 버켓의 버저닝을 활성화해야 함
- You will need MFA to
  - 객체 버전 영구 삭제
  - 버켓 버저닝 중단
- You won't need MFA for
  - 버저닝 활성화
  - 삭제된 버전 목록화
  - delete marker
- 오직 버켓 소유자(root account)만이 이 기능을 활성화/비활성화 할 수 있음
- 오직 CLI를 통해서만 사용할 수 있는 기능

<br>

## S3 Default Encryption vs Bucket Policies

- 객체를 업로드하고 암호화하기 위해, 버켓 정책을 사용해서 암호화를 강제할 수 있음
  - 버켓 정책 사용 시 API 호출에 암호화 헤더가 지정되어 있지 않으면 요청이 거부됨
- 다른 방법은 S3의 _"default encryption"_ 옵션을 사용하는 것
- Note: 버켓 정책은 "default encryption"보다 먼저 고려됨

<br>

## S3 Access Log

- S3 버켓에 access하는 모든 로그를 원하는 경우 사용
- target bucket을 지정해서 사용
- S3로 보내지는 모든 요청은 승인 여부와 상관 없이 또다른 S3 버켓에 로깅됨
- data analysis tool을 활용해서 분석해볼 수도 있음
- 혹은 Amazon Athena를 사용해서 분석할 수도 있음
- log format: https://docs.aws.amazon.com/AmazonS3/latest/dev/LogFormat.html

### Warning

- 모니터링 중인 버켓을 로깅 버켓으로 설정하면 안 됨!
  - 애플리케이션 버켓을 로깅 버켓과 분리하라는 뜻
- 이는 로깅 루프를 만들어서, 버켓의 크기가 기하급수적으로 커지게 될 것

<br>

## S3 Replication (CRR & SRR)

- 출처와 목적지는 **반드시 버저닝을 활성화해야 함**
- Cross Region Replication (CRR)
- Same Region Replication (SRR)
- 버켓이 서로 다른 계정에 있을 수 있음
- 복제는 비동기로 아주 빠르게
- S3에게 반드시 적절한 IAM 권한을 부여해야 함
- CRR Use cases: compliance, lower latency access, 계정 간 복제
- SRR Use cases: 로그 집계, 프로덕션 계정과 테스트 계정 사이의 라이브 복제

### Notes

- 활성화 이후에는 오직 새로운 객체들만 복제
  - 소급적용이 아니므로, S3 버켓의 기존 상태는 복제되지 않음
- For DELETE operations:
  - delete marker 또한 복제할 수 있음 (optional setting)
  - 특정 버전 ID를 삭제하도록 지정하면, 버전 ID는 복제되지 않음 (악의적인 삭제 방지)
- There is no "chaining" of replication
  - 만약 bucket 1을 복제해서 bucket 3를 복제한 bucket 2에 담았다면,<br>bucket 1에서의 객체 생성 작업이 bucket 3에 복제되지 않음

<br>

## S3 pre-signed URLs

- SDK 혹은 CLI를 사용해서 생성 가능
  - 다운로드할 때는 CLI가 쉬움
  - 업로드할 때는 반드시 SDK 사용
- 기본 만료 시간은 3,600초(1시간)
  - `--expires-in [seconds]` 인자를 통해 설정 가능
- 사용자는 URL 생성자의 권한을 상속 받음
- Examples:
  - 로그인한 유저에게만 프리미엄 동영상을 다운로드받을 수 있게 할 때
  - 파일을 다운로드할 사용자들의 목록이 동적으로 변경될 경우
  - 유저가 버켓의 특정 위치에만 파일을 업로드하도록 일시적으로 승인할 때
