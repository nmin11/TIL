## What is DNS?

Domain Name System

- 사람에게 친숙한 호스트 이름을 대상 서버 IP 주소로 번역해줌
- 인터넷의 중추 역할
- 계층적 이름 구조를 사용
  - `.com` → `example.com` → `www.example.com`

### DNS Terminologies

- Domain Register
  - 도메인 이름을 등록하는 곳
  - 예시: Route 53, GoDaddy 등
- DNS Records
  - A, AAAA, CNAME, NS 등
- Zone File
  - 모든 DNS 레코드 포함
- Name Server
  - DNS 쿼리를 실제로 해결하는 서버
- Top Level Domain (TLD)
  - 최상위 단계 도메인
  - .com, .us, .in, .gov, .org 등
- Second Level Domain (SLD)
  - 2단계 도메인
  - amazon.com, google.com 등

※ FQDN (Fully Qualified Domain Name)

http://api.www.example.com.

- 전체 주소 도메인 이름
- Protocol, Domain Name, Sub Domain, SLD, TLD, Root(.)로 이루어짐

### How DNS Works

- 웹 브라우저는 `example.com`에 접속할 때 우선 Local DNS Server에 해당 도메인이 있는지 물어봄
- Local DNS Server가 해당 도메인을 찾지 못하면 각 DNS 서버들에게 순차적으로 쿼리를 보냄
  - Root DNS Server에게 도메인을 쿼리
    - Managed by ICANN
  - TLD DNS Server에게 도메인을 쿼리
    - Managed by IANA (Branch of ICANN)
  - SLD DNS Server
    - Managed by Domain Register (Amazon Register 등)

<br>

## Amazon Route 53

- 고가용성 및 확장성을 갖춘, 완전히 관리되고 있는 권한 있는 DNS
  - 권한이 있다는 것은 서비스 사용자가 DNS 레코드를 업데이트할 수 있다는 것
- Route 53 is also a Domain Register
- Route 53의 리소스 관련 health check 가능
- 100%의 SLA 가용성을 제공하는 유일한 AWS 서비스
- 53은 DNS 서비스에서 사용되는 전통적인 포트번호

### Records

- 특정 도메인으로 라우팅하는 방법 정의
- 각 record가 포함하는 것
  - Domain/subdomain Name - e.g, example.com
  - Record Type - e.g, A or AAAA
  - Value - e.g, 123.456.789.123
  - Routing Policy - Route 53이 쿼리에 응답하는 방식
  - TTL - DNS resolver에서 record가 캐싱되는 시간
- Route 53에서 지원하는 DNS record type
  - (⭐ must know) A / AAAA / CNAME / NS
  - (advanced) CAA / DS / MX / NAPTR / PTR / SOA / TXT / SPF / SRV

### Record Types

- A : hostname과 IPv4 매핑
- AAAA : hostname과 IPv6 매핑
- CNAME : hostname을 다른 hostname과 매핑
  - 타겟은 A 혹은 AAAA record
  - DNS namespace 또는 Zone Apex의 상위 노드에 대한 CNAME을 생성할 수 없음
  - 예를 들어 example.com에 대한 CNAME 레코드는 만들 수 없지만, www.example.com에 대한 CNAME 레코드는 만들 수 있음
- NS : Name Servers for the Hosted Zone
  - 서버의 DNS 이름 또는 IP 주소로 호스팅 존에 대한 DNS 쿼리에 응답 가능
  - 트래픽이 도메인으로 라우팅되는 방식을 제어

### Hosted Zones

- 레코드의 컨테이너 : 도메인과 서브도메인으로 가는 트래픽의 라우팅 방식 정의
- Public Hosted Zones
  - public domain 이름을 살 때마다 Public Hosted Zone을 만들 수 있음
  - Public Hosted Zone은 쿼리를 통해 도메인 이름의 IP가 무엇인지 알 수 있음
- Private Hosted Zones
  - 공개되지 않은 도메인 이름 지원
  - VPC만이 URL을 resolve할 수 있음
  - 사기업에는 때때로 회사 네트워크 내에서만 접근할 수 있는 URL이 있음
- AWS에서 만드는 어떤 hosted zone이든 월에 50 센트를 지불해야 함

### Records TTL

- High TTL (24시간 정도)
  - Route 53의 트래픽은 현저히 적을 것
  - 클라이언트가 오래된 레코드를 받게 될 가능성이 있음
- Low TTL (60초 정도)
  - Route 53에 트래픽이 많아서 비용이 많이 듦 (요청 양에 따라 요금 책정)
  - 오래된 레코드의 보관 시간은 짧음
  - 레코드 변경이 전반적으로 더욱 편리해짐
- TTL은 모든 레코드에게 필수적이지만, Alias reocrds는 제외

### CNMAE vs Alias

- AWS Resources(Load Balancer, Cloudfront 등)는 AWS hostname을 노출
  - 보유한 도메인에 hostname을 매핑하고자 할 수 있음
  - 여기에는 2가지 옵션이 있을 수 있는 것
- CNAME
  - hostname이 다른 hostname으로 향하도록 할 수 있음
  - **루트 도메인 이름이 아닌 경우에만 가능!**
- Alias
  - Route 53에게만 한정된 기능
  - hostname이 특정 AWS Resource로 향하도록 할 수 있음
  - **Alias record는 루트 도메인, 비루트 도메인 모두 작동**
  - 무료
  - 자체적으로 health check 가능

### Alias Records

- hostname을 AWS resource에 매핑
- DNS의 확장 기능으로, 시중의모든 DNS에서 가능
- 만약 resource의 IP 주소가 바뀌면 alias record는 자동으로 인식
- CNAME과 달리 Zone Apex라는 DNS namespace의 상위 노드로 사용될 수 있음
- 항상 A 또는 AAAA 타입
  - resource는 IPv4 혹은 IPv6 둘 중 하나
- TTL 설정 불가능
  - Route 53에 의해 자동 설정

### Alias Records Targets

- Elastic Load Balancers
- CloudFront Distributions
- API Gateway
- Elastic Beanstalk environments
- S3 Websites (S3 버킷은 아님)
- VPC Interface Endpoints
- Global Accelerator accelerator
- Route 53 record in the same hosted zone

⭐ **EC2의 DNS 이름에 대해서는 Alias Records 설정 불가!**
